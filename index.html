<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login - FaceFlow AI</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <video autoplay muted loop playsinline id="bg-video">
    <source src="bgvid.mp4" type="video/mp4" />
    Your browser does not support the video tag.
  </video>
  <div class="overlay"></div>

  <div class="content-wrapper">
    <div class="container">
      <h1>Login</h1>
      <form id="loginForm" action="http://localhost:8080/faceflow_ai1/backend/login.php" method="post">
        <input type="email" name="email" id="email" placeholder="Email Address" required>
        <input type="password" name="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
      <p>
        Don't have an account?
        <a href="register.html" id="registerLink">Register here</a>
      </p>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const loginForm = document.getElementById("loginForm");
      const registerLink = document.getElementById("registerLink");
      const contentWrapper = document.querySelector(".content-wrapper");

      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        try {
          const formData = new FormData(loginForm);
          const response = await fetch(loginForm.action, {
            method: "POST",
            body: formData,
          });
          if (!response.ok) {
            throw new Error(`HTTP error: ${response.status}`);
          }
          let data;
          try {
            data = await response.json();
          } catch {
            throw new Error("Invalid JSON response from server");
          }
          if (data.success) {
            localStorage.setItem("user", JSON.stringify({
              username: data.username,
              email: data.email,
              joined: data.joined
            }));
            window.location.href = "http://localhost:8080/faceflow_ai1/main.html";
          } else {
            alert(data.message || "Invalid username or password");
          }
        } catch (error) {
          console.error("Login error:", error);
          alert("An error occurred: " + error.message);
        }
      });
      
      registerLink.addEventListener("click", (e) => {
        e.preventDefault();
        contentWrapper.classList.add("fade-out-up");
        setTimeout(() => {
          window.location.href = e.target.href;
        }, 500);
      });
    });
  </script>
</body>
</html>